<!DOCTYPE html>
<html>
<head>
    <title>W3.CSS Template!</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="styles.css"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
          integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
</head>
<body>

<H1 id="title">WasteNot</H1>
<div id='content' class="container">
    <div class="alert alert-warning" role="alert" id="none-found">
        <p class="lead">No items found matching these criteria</p>
        <a href="filter.html"><i class="fa fa-search"></i>  Search</a>
    </div>

    <div id="search-criteria" class="alert alert-success" role="alert">
        <p>Expiry: <span id="expiration-date"></span> days</p>
        <p>Categories: <span id="categories"></span></p>
        <p>Distance: <<span id="distance"></span> mi</p>

    </div>
    <div id='index' class="flex-container">
        <a data-distance=".5" data-category="fruit" data-expiry='3' href="/items/banana">
            <img src="images/banana.jpg"/>
            <p>3 Bananas</p>
            <p>0.5 Miles</p>
            <p>Expires in 3 days</p>
        </a>
        <a data-distance="1" data-category='vegetable' data-expiry='2' href="/items/banana/">
            <img src="images/cabbage.jpg"/>
            <p>Cabbage</p>
            <p>1.0 Miles</p>
            <p>Expires in 2 days</p>
        </a>
        <a data-distance='2' data-category='dairy' data-expiry='5' href="/items/banana/">
            <img src="images/eggs.jpg"/>
            <p>Dozen Eggs </p>
            <p>2.0 Miles</p>
            <p>Expires in 5 days</p>
        </a>
        <a data-distance='2.1' data-category='other' data-expiry='10' href="/items/banana/">
            <img src="images/garlic.jpg"/>
            <p>Few cloves of garlic</p>
            <p>2.1 Miles</p>
            <p>Expires in 10 days</p>
        </a>
        <a data-distance='2.5' data-category='vegetable' data-expiry='3' href="/items/banana/">
            <img src="images/onion.jpg"/>
            <p>Extra onions</p>
            <p>2.5 Miles</p>
            <p>Expires in 3 days</p>
        </a>
        <a data-distance='2.6' data-category='vegetable' data-expiry='1' href="/items/banana/">
            <img src="images/tomato.jpg"/>
            <p>Tomatoes from my garden</p>
            <p>2.6 Miles</p>
            <p>Expires in 1 days</p>
        </a>
        <a data-distance='3.0' data-category='dairy' data-expiry='6' href="/items/milk/">
            <img src="images/milk.jpg"/>
            <p>2% Milk</p>
            <p>3.0 Miles</p>
            <p>Expires in 6 days</p>
        </a>
        <a data-distance='3.2' data-category='dairy' data-expiry='4' href="/items/cottage/">
            <img src="images/cottage.jpg"/>
            <p>Cottage Cheese</p>
            <p>3.2 Miles</p>
            <p>Expires in 4 days</p>
        </a>
        <a data-distance='3.5' data-category='fruit' data-expiry='10' href="/items/cottage/">
            <img src="images/apple.jpg"/>
            <p>8 Apples</p>
            <p>3.5 Miles</p>
            <p>Expires in 10 days</p>
        </a>
    </div>

</div>

<script>

    function parseFilter() {
        var regex = /[?&]([^=#]+)=([^&#]*)/g,
            url = window.location.href,
            params = {},
            match;
        while (match = regex.exec(url)) {
            params[match[1]] = match[2];
        }

        let distance = parseFloat(params['distance']);
        let expiry = parseFloat(params['expiry']);
        let none_found = document.getElementById('none-found');
        let expiration_span = document.getElementById('expiration-date');
        let categories_span = document.getElementById('categories');
        let distance_span = document.getElementById('distance');
        let search_criteria = document.getElementById('search-criteria');


        if (!distance) {
            search_criteria.style.display = 'none';
            none_found.style.display = 'none';

        }
        console.log('distance: ', distance);
        console.log('expiry: ', expiry);

        let boxes = document.querySelectorAll('#index a');

        if (params['distance']) {
            let num_hidden = 0;
            let categories = params['categories'].toLowerCase().split(',');
            expiration_span.innerText = expiry.toString();
            categories_span.innerText = categories.join(', ');
            distance_span.innerText = distance.toString();


            for (let i = 0; i < boxes.length; i++) {
                let dist = parseFloat(boxes[i].dataset['distance']);
                let expr = parseFloat(boxes[i].dataset['expiry']);
                let category = boxes[i].dataset['category'].toLowerCase();

                if (dist > distance || expr < expiry || (!(categories.includes(category))) ) {
                    boxes[i].style.display = 'none';
                    num_hidden += 1
                }
            }
            console.log(num_hidden,boxes.length);
            if (num_hidden == boxes.length) {
                none_found.style.display = 'inline-block';
                search_criteria.style.display = 'none';

            } else {
                none_found.style.display = 'none';
            }
        }
    }
    parseFilter();

</script>

<navbar>
    <a href="filter.html"><i class="fas fa-search"></i>Search</a>
    <a href="add_listing.html"><i class="fas fa-plus"></i>Add Item</a>
    <a href="index.html"><i class="fas fa-home"></i>Home</a>
    <a href="profileview.html"><i class="fas fa-bars"></i>Menu</a>
</navbar>
</body>
</html>
